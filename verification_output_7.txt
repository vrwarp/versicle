#0 building with "default" instance using docker driver

#1 [internal] load build definition from Dockerfile.verification
#1 transferring dockerfile: 43B 0.1s
#1 transferring dockerfile: 1.11kB 0.2s done
#1 DONE 0.2s

#2 resolve image config for docker-image://docker.io/docker/dockerfile:1
#2 DONE 0.8s

#3 docker-image://docker.io/docker/dockerfile:1@sha256:b6afd42430b15f2d2a4c5a02b919e98a525b785b1aaff16747d2f623364e39b6
#3 CACHED

#4 [internal] load metadata for mcr.microsoft.com/playwright/python:v1.48.0-jammy
#4 DONE 0.2s

#5 [internal] load .dockerignore
#5 transferring context: 98B done
#5 DONE 0.0s

#6 [ 1/12] FROM mcr.microsoft.com/playwright/python:v1.48.0-jammy@sha256:6bbd515848db4042068571135979b6ee6d330a794b28e037e3a6ccd7f2abfa26
#6 DONE 0.0s

#7 [internal] load build context
#7 transferring context: 18.34MB 0.3s done
#7 DONE 0.3s

#8 [ 2/12] WORKDIR /app
#8 CACHED

#9 [ 3/12] RUN curl -fsSL https://deb.nodesource.com/setup_20.x | bash - &&     apt-get install -y nodejs &&     node --version &&     npm --version
#9 CACHED

#10 [ 4/12] COPY package.json package-lock.json ./
#10 CACHED

#11 [ 6/12] RUN npm ci
#11 CACHED

#12 [ 7/12] RUN pip install pytest pytest-playwright pytest-xdist playwright==1.48.0
#12 CACHED

#13 [ 5/12] COPY scripts ./scripts
#13 CACHED

#14 [ 8/12] RUN playwright install
#14 CACHED

#15 [ 9/12] COPY . .
#15 DONE 46.3s

#16 [10/12] RUN npm run build
#16 18.40
#16 18.40 > versicle@0.0.0 build
#16 18.40 > tsc -b && vite build
#16 18.40
#16 28.01 vite v7.3.0 building client environment for production...
#16 28.41 transforming...
#16 39.89 âœ“ 2178 modules transformed.
#16 42.61 rendering chunks...
#16 43.35 [plugin vite:reporter]
#16 43.35 (!) /app/node_modules/y-indexeddb/src/y-indexeddb.js is dynamically imported by /app/src/lib/BackupService.ts but also statically imported by /app/src/store/yjs-provider.ts, dynamic import will not move module into another chunk.
#16 43.35
#16 43.35 [plugin vite:reporter]
#16 43.35 (!) /app/src/store/yjs-provider.ts is dynamically imported by /app/src/lib/BackupService.ts but also statically imported by /app/src/App.tsx, /app/src/lib/BackupService.ts, /app/src/lib/migration/YjsMigration.ts, /app/src/lib/sync/FirestoreSyncManager.ts, /app/src/lib/sync/YjsSyncService.ts, /app/src/store/useAnnotationStore.ts, /app/src/store/useLibraryStore.ts, /app/src/store/usePreferencesStore.ts, /app/src/store/useReadingListStore.ts, /app/src/store/useReadingStateStore.ts, dynamic import will not move module into another chunk.
#16 43.35
#16 43.35 [plugin vite:reporter]
#16 43.35 (!) /app/src/store/useTTSStore.ts is dynamically imported by /app/src/lib/tts/LexiconService.ts but also statically imported by /app/src/components/GlobalSettingsDialog.tsx, /app/src/components/reader/ReaderControlBar.tsx, /app/src/components/reader/ReaderTTSController.tsx, /app/src/components/reader/ReaderView.tsx, /app/src/components/reader/TTSAbbreviationSettings.tsx, /app/src/components/reader/TTSQueue.tsx, /app/src/components/reader/UnifiedAudioPanel.tsx, /app/src/components/reader/UnifiedInputController.tsx, /app/src/components/ui/CompassPill.tsx, /app/src/hooks/useSectionDuration.ts, /app/src/hooks/useTTS.ts, /app/src/lib/tts/AudioContentPipeline.ts, /app/src/store/useLibraryStore.ts, dynamic import will not move module into another chunk.
#16 43.35
#16 43.35 [plugin vite:reporter]
#16 43.35 (!) /app/src/store/useLibraryStore.ts is dynamically imported by /app/src/lib/BackupService.ts, /app/src/lib/BackupService.ts but also statically imported by /app/src/App.tsx, /app/src/components/GlobalSettingsDialog.tsx, /app/src/components/library/DeleteBookDialog.tsx, /app/src/components/library/EmptyLibrary.tsx, /app/src/components/library/FileUploader.tsx, /app/src/components/library/LibraryView.tsx, /app/src/components/library/OffloadBookDialog.tsx, /app/src/components/library/ReprocessingInterstitial.tsx, /app/src/lib/migration/YjsMigration.ts, /app/src/store/selectors.ts, /app/src/store/useReadingStateStore.ts, dynamic import will not move module into another chunk.
#16 43.35
#16 47.02 computing gzip size...
#16 47.20 dist/registerSW.js                              0.13 kB
#16 47.20 dist/manifest.webmanifest                       0.36 kB
#16 47.20 dist/index.html                                 0.76 kB â”‚ gzip:   0.38 kB
#16 47.20 dist/assets/silence-B6oov6b9.ogg                4.12 kB
#16 47.20 dist/assets/search.worker-DyNrTPTN.js           5.22 kB
#16 47.20 dist/assets/white-noise-U8_pGdEo.ogg          201.37 kB
#16 47.20 dist/assets/index-DROifTTH.css                 63.77 kB â”‚ gzip:  11.53 kB
#16 47.20 dist/assets/rasterize-JS5G2XHH-B_d6BCN-.js      0.36 kB â”‚ gzip:   0.28 kB â”‚ map:     0.83 kB
#16 47.20 dist/assets/toBlob-byzRNT5x.js                  0.36 kB â”‚ gzip:   0.29 kB â”‚ map:     0.89 kB
#16 47.20 dist/assets/web-C4G6R-B9.js                     0.40 kB â”‚ gzip:   0.28 kB â”‚ map:     1.21 kB
#16 47.20 dist/assets/download-C2cmjSzx.js                0.64 kB â”‚ gzip:   0.42 kB â”‚ map:     1.53 kB
#16 47.20 dist/assets/web-B_OLZUiq.js                     0.87 kB â”‚ gzip:   0.30 kB â”‚ map:     2.02 kB
#16 47.20 dist/assets/toImg-DukqhQzw.js                   1.30 kB â”‚ gzip:   0.65 kB â”‚ map:     2.90 kB
#16 47.20 dist/assets/web-CzxOWp1O.js                     1.69 kB â”‚ gzip:   0.72 kB â”‚ map:     5.07 kB
#16 47.20 dist/assets/toCanvas-Bsmm5eIB.js                2.55 kB â”‚ gzip:   1.32 kB â”‚ map:     6.62 kB
#16 47.20 dist/assets/web-BqgDDHtb.js                     8.71 kB â”‚ gzip:   2.99 kB â”‚ map:    35.69 kB
#16 47.20 dist/assets/index-xrP4oqh4.js               1,908.42 kB â”‚ gzip: 589.80 kB â”‚ map: 8,980.08 kB
#16 47.20
#16 47.20 (!) Some chunks are larger than 500 kB after minification. Consider:
#16 47.20 - Using dynamic import() to code-split the application
#16 47.20 - Use build.rollupOptions.output.manualChunks to improve chunking: https://rollupjs.org/configuration-options/#output-manualchunks
#16 47.20 - Adjust chunk size limit for this warning via build.chunkSizeWarningLimit.
#16 47.20 âœ“ built in 19.15s
#16 47.21
#16 47.21 PWA v1.2.0
#16 47.21 Building src/sw.ts service worker ("es" format)...
#16 48.19 vite v7.3.0 building client environment for production...
#16 48.20 transforming...
#16 48.43 âœ“ 67 modules transformed.
#16 48.46 rendering chunks...
#16 48.48 computing gzip size...
#16 48.48 dist/sw.mjs  20.71 kB â”‚ gzip: 7.11 kB â”‚ map: 161.90 kB
#16 48.48 âœ“ built in 285ms
#16 48.61
#16 48.61 PWA v1.2.0
#16 48.61 mode      injectManifest
#16 48.61 format:   es
#16 48.61 precache  21 entries (2697.91 KiB)
#16 48.61 files generated
#16 48.61   dist/sw.js
#16 48.61   dist/sw.js.map
#16 DONE 48.8s

#17 [11/12] COPY verification/docker_entrypoint.sh /app/verification/docker_entrypoint.sh
#17 DONE 31.4s

#18 [12/12] RUN chmod +x /app/verification/docker_entrypoint.sh
#18 DONE 37.9s

#19 exporting to image
#19 exporting layers
#19 exporting layers 9.6s done
#19 writing image sha256:6c129d592ff0647ee1339baed273a859f8ce4e7faabe7c18fa784ee03355f8b1 done
#19 naming to docker.io/library/versicle-verify 0.0s done
#19 DONE 9.7s
ğŸƒ Running verification tests...
ğŸš€ Starting Vite Preview Server...
â³ Waiting for application to be ready at http://localhost:5173...

> versicle@0.0.0 preview
> vite preview --port 5173 --host

  âœ  Local:   http://localhost:5173/
  âœ  Network: http://172.17.0.2:5173/
âœ… Application is ready!
ğŸ§ª Running verification suite...
============================= test session starts ==============================
platform linux -- Python 3.10.12, pytest-9.0.2, pluggy-1.6.0
rootdir: /app
plugins: xdist-3.8.0, playwright-0.7.2, base-url-2.1.0
created: 4/4 workers
4 workers [154 items]

...............................F........................................ [ 46%]
................F.............F.......F................................. [ 93%]
..........                                                               [100%]
=================================== FAILURES ===================================
______________ test_firestore_cross_device_sync[desktop-chromium] ______________
[gw2] linux -- Python 3.10.12 /usr/bin/python

browser = <Browser type=<BrowserType name=chromium executable_path=/ms-playwright/chromium-1140/chrome-linux/chrome> version=130.0.6723.31>
browser_context_args = {'base_url': 'http://localhost:5173', 'viewport': {'height': 720, 'width': 1280}}

    def test_firestore_cross_device_sync(browser: Browser, browser_context_args):
        """
        Verifies cross-device syncing using MockFireProvider.
        Device A creates data, Device B should see it after sync.
        """
        base_url = browser_context_args.get("base_url", "http://localhost:5173")

        # --- Device A: Create Data & Sync ---
        print("Starting Device A...")
        context_a = browser.new_context(**browser_context_args)
        page_a = context_a.new_page()

        page_a.on("console", lambda msg: print(f"DEVICE A: {msg.text}"))

        # Enable mock Firestore mode
        page_a.add_init_script("""
            window.__VERSICLE_MOCK_FIRESTORE__ = true;
            window.__VERSICLE_SANITIZATION_DISABLED__ = true;
        """)
        page_a.add_init_script(path="verification/tts-polyfill.js")

        page_a.goto("/")
        expect(page_a.get_by_test_id("library-view")).to_be_visible()

        # Change theme (easy to verify synced data via usePreferencesStore)
        page_a.get_by_test_id("header-settings-button").click()

        # Change to Dark mode
>       page_a.locator("button[value='dark']").click()

verification/test_journey_firestore_sync.py:91:
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
/usr/local/lib/python3.10/dist-packages/playwright/sync_api/_generated.py:15398: in click
    self._sync(
/usr/local/lib/python3.10/dist-packages/playwright/_impl/_locator.py:156: in click
    return await self._frame.click(self._selector, strict=True, **params)
/usr/local/lib/python3.10/dist-packages/playwright/_impl/_frame.py:488: in click
    await self._channel.send("click", locals_to_params(locals()))
/usr/local/lib/python3.10/dist-packages/playwright/_impl/_connection.py:59: in send
    return await self._connection.wrap_api_call(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <playwright._impl._connection.Connection object at 0x7fd63bcbdc00>
cb = <function Channel.send.<locals>.<lambda> at 0x7fd63bb096c0>
is_internal = False

    async def wrap_api_call(
        self, cb: Callable[[], Any], is_internal: bool = False
    ) -> Any:
        if self._api_zone.get():
            return await cb()
        task = asyncio.current_task(self._loop)
        st: List[inspect.FrameInfo] = getattr(task, "__pw_stack__", inspect.stack())
        parsed_st = _extract_stack_trace_information_from_stack(st, is_internal)
        self._api_zone.set(parsed_st)
        try:
            return await cb()
        except Exception as error:
>           raise rewrite_error(error, f"{parsed_st['apiName']}: {error}") from None
E           playwright._impl._errors.TimeoutError: Locator.click: Timeout 30000ms exceeded.
E           Call log:
E           waiting for locator("button[value='dark']")

/usr/local/lib/python3.10/dist-packages/playwright/_impl/_connection.py:520: TimeoutError
----------------------------- Captured stdout call -----------------------------
Starting Device A...
DEVICE A: %c ğŸ—£ï¸ [MockTTS] Injecting Polyfill (Web Worker) background: #222; color: #bada55
DEVICE A: ğŸ—£ï¸ [MockTTS] Worker Initialized
DEVICE A: ğŸ—£ï¸ [MockTTS] window.speechSynthesis overwritten
DEVICE A: ğŸ—£ï¸ [MockTTS] Dispatching voiceschanged
DEVICE A: Migrating to v18 Data Architecture...
DEVICE A: Migrating to v20: Fixing Reading List Progress...
DEVICE A: Migrating to v21: Seeding User Reading List...
DEVICE A: âœ… [Yjs] Content loaded from IndexedDB (versicle-yjs)
DEVICE A: Migrating to v22: Repairing corrupted filenames...
DEVICE A: v22 Migration Complete. Repaired 0 books.
DEVICE A: [Migration] Starting Yjs migration check...
DEVICE A: [Migration] ğŸ”„ Migrating from legacy IndexedDB...
DEVICE A: [Migration] Found 0 books, 0 annotations, 0 progress entries, 0 reading list entries
DEVICE A: [Migration] Migrated 0 books, 0 progress entries, and 0 reading list entries
DEVICE A: [Migration] Migrated 0 annotations
DEVICE A: [Migration] All data migrated to Yjs
DEVICE A: [Migration] âœ… Migration complete!
DEVICE A: [Hydrate] Called. Books in store: 0
DEVICE A: [OffloadBookDialog] Rendered. isOpen: false, bookId: undefined, isOffloading: false
DEVICE A: [FirestoreSync] Mock mode detected. Simulating auth and connection.
DEVICE A: [FirestoreSync] Using MockFireProvider (test mode)
DEVICE A: [MockFireProvider] Initialized for path: users/mock-user/versicle/main
DEVICE A: [FirestoreSync] Connected to path: users/mock-user/versicle/main
DEVICE A: [MockFireProvider] Ready
DEVICE A: [OffloadBookDialog] Rendered. isOpen: false, bookId: undefined, isOffloading: false
DEVICE A: Warning: Missing `Description` or `aria-describedby={undefined}` for {DialogContent}.
______________ test_firestore_cross_device_sync[mobile-chromium] _______________
[gw2] linux -- Python 3.10.12 /usr/bin/python

browser = <Browser type=<BrowserType name=chromium executable_path=/ms-playwright/chromium-1140/chrome-linux/chrome> version=130.0.6723.31>
browser_context_args = {'base_url': 'http://localhost:5173', 'has_touch': True, 'is_mobile': True, 'viewport': {'height': 667, 'width': 375}}

    def test_firestore_cross_device_sync(browser: Browser, browser_context_args):
        """
        Verifies cross-device syncing using MockFireProvider.
        Device A creates data, Device B should see it after sync.
        """
        base_url = browser_context_args.get("base_url", "http://localhost:5173")

        # --- Device A: Create Data & Sync ---
        print("Starting Device A...")
        context_a = browser.new_context(**browser_context_args)
        page_a = context_a.new_page()

        page_a.on("console", lambda msg: print(f"DEVICE A: {msg.text}"))

        # Enable mock Firestore mode
        page_a.add_init_script("""
            window.__VERSICLE_MOCK_FIRESTORE__ = true;
            window.__VERSICLE_SANITIZATION_DISABLED__ = true;
        """)
        page_a.add_init_script(path="verification/tts-polyfill.js")

        page_a.goto("/")
        expect(page_a.get_by_test_id("library-view")).to_be_visible()

        # Change theme (easy to verify synced data via usePreferencesStore)
        page_a.get_by_test_id("header-settings-button").click()

        # Change to Dark mode
>       page_a.locator("button[value='dark']").click()

verification/test_journey_firestore_sync.py:91:
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
/usr/local/lib/python3.10/dist-packages/playwright/sync_api/_generated.py:15398: in click
    self._sync(
/usr/local/lib/python3.10/dist-packages/playwright/_impl/_locator.py:156: in click
    return await self._frame.click(self._selector, strict=True, **params)
/usr/local/lib/python3.10/dist-packages/playwright/_impl/_frame.py:488: in click
    await self._channel.send("click", locals_to_params(locals()))
/usr/local/lib/python3.10/dist-packages/playwright/_impl/_connection.py:59: in send
    return await self._connection.wrap_api_call(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <playwright._impl._connection.Connection object at 0x7fd63bcbdc00>
cb = <function Channel.send.<locals>.<lambda> at 0x7fd63afc3400>
is_internal = False

    async def wrap_api_call(
        self, cb: Callable[[], Any], is_internal: bool = False
    ) -> Any:
        if self._api_zone.get():
            return await cb()
        task = asyncio.current_task(self._loop)
        st: List[inspect.FrameInfo] = getattr(task, "__pw_stack__", inspect.stack())
        parsed_st = _extract_stack_trace_information_from_stack(st, is_internal)
        self._api_zone.set(parsed_st)
        try:
            return await cb()
        except Exception as error:
>           raise rewrite_error(error, f"{parsed_st['apiName']}: {error}") from None
E           playwright._impl._errors.TimeoutError: Locator.click: Timeout 30000ms exceeded.
E           Call log:
E           waiting for locator("button[value='dark']")

/usr/local/lib/python3.10/dist-packages/playwright/_impl/_connection.py:520: TimeoutError
----------------------------- Captured stdout call -----------------------------
Starting Device A...
DEVICE A: %c ğŸ—£ï¸ [MockTTS] Injecting Polyfill (Web Worker) background: #222; color: #bada55
DEVICE A: ğŸ—£ï¸ [MockTTS] Worker Initialized
DEVICE A: ğŸ—£ï¸ [MockTTS] window.speechSynthesis overwritten
DEVICE A: Migrating to v18 Data Architecture...
DEVICE A: Migrating to v20: Fixing Reading List Progress...
DEVICE A: Migrating to v21: Seeding User Reading List...
DEVICE A: âœ… [Yjs] Content loaded from IndexedDB (versicle-yjs)
DEVICE A: Migrating to v22: Repairing corrupted filenames...
DEVICE A: v22 Migration Complete. Repaired 0 books.
DEVICE A: ğŸ—£ï¸ [MockTTS] Dispatching voiceschanged
DEVICE A: [Migration] Starting Yjs migration check...
DEVICE A: [Migration] ğŸ”„ Migrating from legacy IndexedDB...
DEVICE A: [Migration] Found 0 books, 0 annotations, 0 progress entries, 0 reading list entries
DEVICE A: [Migration] Migrated 0 books, 0 progress entries, and 0 reading list entries
DEVICE A: [Migration] Migrated 0 annotations
DEVICE A: [Migration] All data migrated to Yjs
DEVICE A: [Migration] âœ… Migration complete!
DEVICE A: [Hydrate] Called. Books in store: 0
DEVICE A: [OffloadBookDialog] Rendered. isOpen: false, bookId: undefined, isOffloading: false
DEVICE A: [FirestoreSync] Mock mode detected. Simulating auth and connection.
DEVICE A: [FirestoreSync] Using MockFireProvider (test mode)
DEVICE A: [MockFireProvider] Initialized for path: users/mock-user/versicle/main
DEVICE A: [FirestoreSync] Connected to path: users/mock-user/versicle/main
DEVICE A: [MockFireProvider] Ready
DEVICE A: [OffloadBookDialog] Rendered. isOpen: false, bookId: undefined, isOffloading: false
DEVICE A: Warning: Missing `Description` or `aria-describedby={undefined}` for {DialogContent}.
_________________ test_journey_visual_reading[mobile-chromium] _________________
[gw3] linux -- Python 3.10.12 /usr/bin/python

page = <Page url='http://localhost:5173/'>

    def test_journey_visual_reading(page: Page):
        """
        User Journey: Visual Reading Interactions (Flow Mode)
        Verifies tap zones for page navigation and HUD toggling.
        Updated: Tap navigation is now restricted to Immersive Mode.
        """
        reset_app(page)

        # 1. Load Book
        page.click("text=Load Demo Book (Alice in Wonderland)")
>       expect(page.locator("text=Alice's Adventures in Wonderland")).to_be_visible(timeout=5000)
E       AssertionError: Locator expected to be visible
E       Actual value: <element(s) not found>
E       Call log:
E       LocatorAssertions.to_be_visible with timeout 5000ms
E         - waiting for locator("text=Alice's Adventures in Wonderland")

verification/test_journey_visual_reading.py:15: AssertionError
----------------------------- Captured stdout call -----------------------------
PAGE LOG: %c ğŸ—£ï¸ [MockTTS] Injecting Polyfill (Web Worker) background: #222; color: #bada55
PAGE LOG: ğŸ—£ï¸ [MockTTS] Worker Initialized
PAGE LOG: ğŸ—£ï¸ [MockTTS] window.speechSynthesis overwritten
PAGE LOG: ğŸ—£ï¸ [MockTTS] Dispatching voiceschanged
PAGE LOG: %c ğŸ—£ï¸ [MockTTS] Injecting Polyfill (Web Worker) background: #222; color: #bada55
PAGE LOG: ğŸ—£ï¸ [MockTTS] Worker Initialized
PAGE LOG: ğŸ—£ï¸ [MockTTS] window.speechSynthesis overwritten
PAGE LOG: âœ… [Yjs] Content loaded from IndexedDB (versicle-yjs)
PAGE LOG: Migrating to v18 Data Architecture...
PAGE LOG: Migrating to v20: Fixing Reading List Progress...
PAGE LOG: Migrating to v21: Seeding User Reading List...
PAGE LOG: Migrating to v22: Repairing corrupted filenames...
PAGE LOG: v22 Migration Complete. Repaired 0 books.
PAGE LOG: [Migration] Starting Yjs migration check...
PAGE LOG: [Migration] ğŸ”„ Migrating from legacy IndexedDB...
PAGE LOG: [Migration] Found 0 books, 0 annotations, 0 progress entries, 0 reading list entries
PAGE LOG: [Migration] Migrated 0 books, 0 progress entries, and 0 reading list entries
PAGE LOG: [Migration] Migrated 0 annotations
PAGE LOG: [Migration] All data migrated to Yjs
PAGE LOG: [Migration] âœ… Migration complete!
PAGE LOG: ğŸ—£ï¸ [MockTTS] Dispatching voiceschanged
PAGE LOG: DB EpubLibraryDB deletion blocked
PAGE LOG: %c ğŸ—£ï¸ [MockTTS] Injecting Polyfill (Web Worker) background: #222; color: #bada55
PAGE LOG: ğŸ—£ï¸ [MockTTS] Worker Initialized
PAGE LOG: ğŸ—£ï¸ [MockTTS] window.speechSynthesis overwritten
PAGE LOG: Migrating to v18 Data Architecture...
PAGE LOG: Migrating to v20: Fixing Reading List Progress...
PAGE LOG: Migrating to v21: Seeding User Reading List...
PAGE LOG: âœ… [Yjs] Content loaded from IndexedDB (versicle-yjs)
PAGE LOG: Migrating to v22: Repairing corrupted filenames...
PAGE LOG: v22 Migration Complete. Repaired 0 books.
PAGE LOG: [Migration] Starting Yjs migration check...
PAGE LOG: [Migration] ğŸ”„ Migrating from legacy IndexedDB...
PAGE LOG: [Migration] Found 0 books, 0 annotations, 0 progress entries, 0 reading list entries
PAGE LOG: [Migration] Migrated 0 books, 0 progress entries, and 0 reading list entries
PAGE LOG: [Migration] Migrated 0 annotations
PAGE LOG: [Migration] All data migrated to Yjs
PAGE LOG: [Migration] âœ… Migration complete!
PAGE LOG: ğŸ—£ï¸ [MockTTS] Dispatching voiceschanged
PAGE LOG: [Hydrate] Called. Books in store: 0
PAGE LOG: [OffloadBookDialog] Rendered. isOpen: false, bookId: undefined, isOffloading: false
PAGE LOG: [OffloadBookDialog] Rendered. isOpen: false, bookId: undefined, isOffloading: false
PAGE LOG: %c ğŸ—£ï¸ [MockTTS] Injecting Polyfill (Web Worker) background: #222; color: #bada55
PAGE LOG: ğŸ—£ï¸ [MockTTS] Worker Initialized
PAGE LOG: ğŸ—£ï¸ [MockTTS] window.speechSynthesis overwritten
PAGE LOG: Blocked script execution in 'about:srcdoc' because the document's frame is sandboxed and the 'allow-scripts' permission is not set.
PAGE LOG: %c ğŸ—£ï¸ [MockTTS] Injecting Polyfill (Web Worker) background: #222; color: #bada55
PAGE LOG: ğŸ—£ï¸ [MockTTS] Worker Initialized
PAGE LOG: ğŸ—£ï¸ [MockTTS] window.speechSynthesis overwritten
PAGE LOG: Blocked script execution in 'about:srcdoc' because the document's frame is sandboxed and the 'allow-scripts' permission is not set.
PAGE LOG: %c ğŸ—£ï¸ [MockTTS] Injecting Polyfill (Web Worker) background: #222; color: #bada55
PAGE LOG: ğŸ—£ï¸ [MockTTS] Worker Initialized
PAGE LOG: ğŸ—£ï¸ [MockTTS] window.speechSynthesis overwritten
PAGE LOG: Blocked script execution in 'about:srcdoc' because the document's frame is sandboxed and the 'allow-scripts' permission is not set.
PAGE LOG: %c ğŸ—£ï¸ [MockTTS] Injecting Polyfill (Web Worker) background: #222; color: #bada55
PAGE LOG: ğŸ—£ï¸ [MockTTS] Worker Initialized
PAGE LOG: ğŸ—£ï¸ [MockTTS] window.speechSynthesis overwritten
PAGE LOG: Blocked script execution in 'about:srcdoc' because the document's frame is sandboxed and the 'allow-scripts' permission is not set.
PAGE LOG: %c ğŸ—£ï¸ [MockTTS] Injecting Polyfill (Web Worker) background: #222; color: #bada55
PAGE LOG: ğŸ—£ï¸ [MockTTS] Worker Initialized
PAGE LOG: ğŸ—£ï¸ [MockTTS] window.speechSynthesis overwritten
PAGE LOG: Blocked script execution in 'about:srcdoc' because the document's frame is sandboxed and the 'allow-scripts' permission is not set.
PAGE LOG: %c ğŸ—£ï¸ [MockTTS] Injecting Polyfill (Web Worker) background: #222; color: #bada55
PAGE LOG: ğŸ—£ï¸ [MockTTS] Worker Initialized
PAGE LOG: ğŸ—£ï¸ [MockTTS] window.speechSynthesis overwritten
PAGE LOG: Blocked script execution in 'about:srcdoc' because the document's frame is sandboxed and the 'allow-scripts' permission is not set.
PAGE LOG: %c ğŸ—£ï¸ [MockTTS] Injecting Polyfill (Web Worker) background: #222; color: #bada55
PAGE LOG: ğŸ—£ï¸ [MockTTS] Worker Initialized
PAGE LOG: ğŸ—£ï¸ [MockTTS] window.speechSynthesis overwritten
PAGE LOG: Blocked script execution in 'about:srcdoc' because the document's frame is sandboxed and the 'allow-scripts' permission is not set.
PAGE LOG: %c ğŸ—£ï¸ [MockTTS] Injecting Polyfill (Web Worker) background: #222; color: #bada55
PAGE LOG: ğŸ—£ï¸ [MockTTS] Worker Initialized
PAGE LOG: ğŸ—£ï¸ [MockTTS] window.speechSynthesis overwritten
PAGE LOG: Blocked script execution in 'about:srcdoc' because the document's frame is sandboxed and the 'allow-scripts' permission is not set.
PAGE LOG: %c ğŸ—£ï¸ [MockTTS] Injecting Polyfill (Web Worker) background: #222; color: #bada55
PAGE LOG: ğŸ—£ï¸ [MockTTS] Worker Initialized
PAGE LOG: ğŸ—£ï¸ [MockTTS] window.speechSynthesis overwritten
PAGE LOG: Blocked script execution in 'about:srcdoc' because the document's frame is sandboxed and the 'allow-scripts' permission is not set.
PAGE LOG: %c ğŸ—£ï¸ [MockTTS] Injecting Polyfill (Web Worker) background: #222; color: #bada55
PAGE LOG: ğŸ—£ï¸ [MockTTS] Worker Initialized
PAGE LOG: ğŸ—£ï¸ [MockTTS] window.speechSynthesis overwritten
PAGE LOG: Blocked script execution in 'about:srcdoc' because the document's frame is sandboxed and the 'allow-scripts' permission is not set.
PAGE LOG: %c ğŸ—£ï¸ [MockTTS] Injecting Polyfill (Web Worker) background: #222; color: #bada55
PAGE LOG: ğŸ—£ï¸ [MockTTS] Worker Initialized
PAGE LOG: ğŸ—£ï¸ [MockTTS] window.speechSynthesis overwritten
PAGE LOG: Blocked script execution in 'about:srcdoc' because the document's frame is sandboxed and the 'allow-scripts' permission is not set.
PAGE LOG: %c ğŸ—£ï¸ [MockTTS] Injecting Polyfill (Web Worker) background: #222; color: #bada55
PAGE LOG: ğŸ—£ï¸ [MockTTS] Worker Initialized
PAGE LOG: ğŸ—£ï¸ [MockTTS] window.speechSynthesis overwritten
PAGE LOG: Blocked script execution in 'about:srcdoc' because the document's frame is sandboxed and the 'allow-scripts' permission is not set.
PAGE LOG: %c ğŸ—£ï¸ [MockTTS] Injecting Polyfill (Web Worker) background: #222; color: #bada55
PAGE LOG: ğŸ—£ï¸ [MockTTS] Worker Initialized
PAGE LOG: ğŸ—£ï¸ [MockTTS] window.speechSynthesis overwritten
PAGE LOG: Blocked script execution in 'about:srcdoc' because the document's frame is sandboxed and the 'allow-scripts' permission is not set.
PAGE LOG: %c ğŸ—£ï¸ [MockTTS] Injecting Polyfill (Web Worker) background: #222; color: #bada55
PAGE LOG: ğŸ—£ï¸ [MockTTS] Worker Initialized
PAGE LOG: ğŸ—£ï¸ [MockTTS] window.speechSynthesis overwritten
PAGE LOG: Blocked script execution in 'about:srcdoc' because the document's frame is sandboxed and the 'allow-scripts' permission is not set.
PAGE LOG: %c ğŸ—£ï¸ [MockTTS] Injecting Polyfill (Web Worker) background: #222; color: #bada55
PAGE LOG: ğŸ—£ï¸ [MockTTS] Worker Initialized
PAGE LOG: ğŸ—£ï¸ [MockTTS] window.speechSynthesis overwritten
PAGE LOG: Blocked script execution in 'about:srcdoc' because the document's frame is sandboxed and the 'allow-scripts' permission is not set.
PAGE LOG: [OffloadBookDialog] Rendered. isOpen: false, bookId: undefined, isOffloading: false
PAGE LOG: [BookCover] Rendering Alice's Adventures in Wonderland (69d65673-f171-4a5e-8f8d-30bf44196ed9). isOffloaded: false
__________________ test_verify_progress_bar[mobile-chromium] ___________________
[gw2] linux -- Python 3.10.12 /usr/bin/python

page = <Page url='http://localhost:5173/'>

    def test_verify_progress_bar(page: Page):
        # 1. Reset app to ensure clean state
        reset_app(page)

        # 2. Add the demo book (Alice in Wonderland)
        page.wait_for_timeout(2000)

        if page.get_by_text("Load Demo Book").is_visible():
            page.get_by_text("Load Demo Book").click()
>           expect(page.get_by_text("Alice's Adventures in Wonderland")).to_be_visible(timeout=5000)
E           AssertionError: Locator expected to be visible
E           Actual value: <element(s) not found>
E           Call log:
E           LocatorAssertions.to_be_visible with timeout 5000ms
E             - waiting for get_by_text("Alice's Adventures in Wonderland")

verification/test_journey_progress_bar.py:14: AssertionError
----------------------------- Captured stdout call -----------------------------
PAGE LOG: %c ğŸ—£ï¸ [MockTTS] Injecting Polyfill (Web Worker) background: #222; color: #bada55
PAGE LOG: ğŸ—£ï¸ [MockTTS] Worker Initialized
PAGE LOG: ğŸ—£ï¸ [MockTTS] window.speechSynthesis overwritten
PAGE LOG: ğŸ—£ï¸ [MockTTS] Dispatching voiceschanged
PAGE LOG: %c ğŸ—£ï¸ [MockTTS] Injecting Polyfill (Web Worker) background: #222; color: #bada55
PAGE LOG: ğŸ—£ï¸ [MockTTS] Worker Initialized
PAGE LOG: ğŸ—£ï¸ [MockTTS] window.speechSynthesis overwritten
PAGE LOG: âœ… [Yjs] Content loaded from IndexedDB (versicle-yjs)
PAGE LOG: Migrating to v18 Data Architecture...
PAGE LOG: Migrating to v20: Fixing Reading List Progress...
PAGE LOG: Migrating to v21: Seeding User Reading List...
PAGE LOG: Migrating to v22: Repairing corrupted filenames...
PAGE LOG: v22 Migration Complete. Repaired 0 books.
PAGE LOG: [Migration] Starting Yjs migration check...
PAGE LOG: [Migration] ğŸ”„ Migrating from legacy IndexedDB...
PAGE LOG: [Migration] Found 0 books, 0 annotations, 0 progress entries, 0 reading list entries
PAGE LOG: [Migration] Migrated 0 books, 0 progress entries, and 0 reading list entries
PAGE LOG: [Migration] Migrated 0 annotations
PAGE LOG: [Migration] All data migrated to Yjs
PAGE LOG: [Migration] âœ… Migration complete!
PAGE LOG: ğŸ—£ï¸ [MockTTS] Dispatching voiceschanged
PAGE LOG: DB EpubLibraryDB deletion blocked
PAGE LOG: %c ğŸ—£ï¸ [MockTTS] Injecting Polyfill (Web Worker) background: #222; color: #bada55
PAGE LOG: ğŸ—£ï¸ [MockTTS] Worker Initialized
PAGE LOG: ğŸ—£ï¸ [MockTTS] window.speechSynthesis overwritten
PAGE LOG: Migrating to v18 Data Architecture...
PAGE LOG: Migrating to v20: Fixing Reading List Progress...
PAGE LOG: Migrating to v21: Seeding User Reading List...
PAGE LOG: âœ… [Yjs] Content loaded from IndexedDB (versicle-yjs)
PAGE LOG: Migrating to v22: Repairing corrupted filenames...
PAGE LOG: v22 Migration Complete. Repaired 0 books.
PAGE LOG: [Migration] Starting Yjs migration check...
PAGE LOG: [Migration] ğŸ”„ Migrating from legacy IndexedDB...
PAGE LOG: [Migration] Found 0 books, 0 annotations, 0 progress entries, 0 reading list entries
PAGE LOG: [Migration] Migrated 0 books, 0 progress entries, and 0 reading list entries
PAGE LOG: [Migration] Migrated 0 annotations
PAGE LOG: [Migration] All data migrated to Yjs
PAGE LOG: [Migration] âœ… Migration complete!
PAGE LOG: ğŸ—£ï¸ [MockTTS] Dispatching voiceschanged
PAGE LOG: [Hydrate] Called. Books in store: 0
PAGE LOG: [OffloadBookDialog] Rendered. isOpen: false, bookId: undefined, isOffloading: false
PAGE LOG: [OffloadBookDialog] Rendered. isOpen: false, bookId: undefined, isOffloading: false
PAGE LOG: %c ğŸ—£ï¸ [MockTTS] Injecting Polyfill (Web Worker) background: #222; color: #bada55
PAGE LOG: ğŸ—£ï¸ [MockTTS] Worker Initialized
PAGE LOG: ğŸ—£ï¸ [MockTTS] window.speechSynthesis overwritten
PAGE LOG: Blocked script execution in 'about:srcdoc' because the document's frame is sandboxed and the 'allow-scripts' permission is not set.
PAGE LOG: %c ğŸ—£ï¸ [MockTTS] Injecting Polyfill (Web Worker) background: #222; color: #bada55
PAGE LOG: ğŸ—£ï¸ [MockTTS] Worker Initialized
PAGE LOG: ğŸ—£ï¸ [MockTTS] window.speechSynthesis overwritten
PAGE LOG: Blocked script execution in 'about:srcdoc' because the document's frame is sandboxed and the 'allow-scripts' permission is not set.
PAGE LOG: Blocked script execution in 'about:srcdoc' because the document's frame is sandboxed and the 'allow-scripts' permission is not set.
PAGE LOG: %c ğŸ—£ï¸ [MockTTS] Injecting Polyfill (Web Worker) background: #222; color: #bada55
PAGE LOG: ğŸ—£ï¸ [MockTTS] Worker Initialized
PAGE LOG: ğŸ—£ï¸ [MockTTS] window.speechSynthesis overwritten
PAGE LOG: Blocked script execution in 'about:srcdoc' because the document's frame is sandboxed and the 'allow-scripts' permission is not set.
PAGE LOG: %c ğŸ—£ï¸ [MockTTS] Injecting Polyfill (Web Worker) background: #222; color: #bada55
PAGE LOG: ğŸ—£ï¸ [MockTTS] Worker Initialized
PAGE LOG: ğŸ—£ï¸ [MockTTS] window.speechSynthesis overwritten
PAGE LOG: Blocked script execution in 'about:srcdoc' because the document's frame is sandboxed and the 'allow-scripts' permission is not set.
PAGE LOG: %c ğŸ—£ï¸ [MockTTS] Injecting Polyfill (Web Worker) background: #222; color: #bada55
PAGE LOG: ğŸ—£ï¸ [MockTTS] Worker Initialized
PAGE LOG: ğŸ—£ï¸ [MockTTS] window.speechSynthesis overwritten
PAGE LOG: Blocked script execution in 'about:srcdoc' because the document's frame is sandboxed and the 'allow-scripts' permission is not set.
PAGE LOG: %c ğŸ—£ï¸ [MockTTS] Injecting Polyfill (Web Worker) background: #222; color: #bada55
PAGE LOG: ğŸ—£ï¸ [MockTTS] Worker Initialized
PAGE LOG: ğŸ—£ï¸ [MockTTS] window.speechSynthesis overwritten
PAGE LOG: Blocked script execution in 'about:srcdoc' because the document's frame is sandboxed and the 'allow-scripts' permission is not set.
PAGE LOG: %c ğŸ—£ï¸ [MockTTS] Injecting Polyfill (Web Worker) background: #222; color: #bada55
PAGE LOG: ğŸ—£ï¸ [MockTTS] Worker Initialized
PAGE LOG: ğŸ—£ï¸ [MockTTS] window.speechSynthesis overwritten
PAGE LOG: Blocked script execution in 'about:srcdoc' because the document's frame is sandboxed and the 'allow-scripts' permission is not set.
PAGE LOG: %c ğŸ—£ï¸ [MockTTS] Injecting Polyfill (Web Worker) background: #222; color: #bada55
PAGE LOG: ğŸ—£ï¸ [MockTTS] Worker Initialized
PAGE LOG: ğŸ—£ï¸ [MockTTS] window.speechSynthesis overwritten
PAGE LOG: Blocked script execution in 'about:srcdoc' because the document's frame is sandboxed and the 'allow-scripts' permission is not set.
PAGE LOG: %c ğŸ—£ï¸ [MockTTS] Injecting Polyfill (Web Worker) background: #222; color: #bada55
PAGE LOG: ğŸ—£ï¸ [MockTTS] Worker Initialized
PAGE LOG: ğŸ—£ï¸ [MockTTS] window.speechSynthesis overwritten
PAGE LOG: Blocked script execution in 'about:srcdoc' because the document's frame is sandboxed and the 'allow-scripts' permission is not set.
PAGE LOG: %c ğŸ—£ï¸ [MockTTS] Injecting Polyfill (Web Worker) background: #222; color: #bada55
PAGE LOG: ğŸ—£ï¸ [MockTTS] Worker Initialized
PAGE LOG: ğŸ—£ï¸ [MockTTS] window.speechSynthesis overwritten
PAGE LOG: Blocked script execution in 'about:srcdoc' because the document's frame is sandboxed and the 'allow-scripts' permission is not set.
PAGE LOG: %c ğŸ—£ï¸ [MockTTS] Injecting Polyfill (Web Worker) background: #222; color: #bada55
PAGE LOG: ğŸ—£ï¸ [MockTTS] Worker Initialized
PAGE LOG: ğŸ—£ï¸ [MockTTS] window.speechSynthesis overwritten
PAGE LOG: Blocked script execution in 'about:srcdoc' because the document's frame is sandboxed and the 'allow-scripts' permission is not set.
PAGE LOG: %c ğŸ—£ï¸ [MockTTS] Injecting Polyfill (Web Worker) background: #222; color: #bada55
PAGE LOG: ğŸ—£ï¸ [MockTTS] Worker Initialized
PAGE LOG: ğŸ—£ï¸ [MockTTS] window.speechSynthesis overwritten
PAGE LOG: Blocked script execution in 'about:srcdoc' because the document's frame is sandboxed and the 'allow-scripts' permission is not set.
PAGE LOG: %c ğŸ—£ï¸ [MockTTS] Injecting Polyfill (Web Worker) background: #222; color: #bada55
PAGE LOG: ğŸ—£ï¸ [MockTTS] Worker Initialized
PAGE LOG: ğŸ—£ï¸ [MockTTS] window.speechSynthesis overwritten
PAGE LOG: Blocked script execution in 'about:srcdoc' because the document's frame is sandboxed and the 'allow-scripts' permission is not set.
PAGE LOG: %c ğŸ—£ï¸ [MockTTS] Injecting Polyfill (Web Worker) background: #222; color: #bada55
PAGE LOG: ğŸ—£ï¸ [MockTTS] Worker Initialized
PAGE LOG: ğŸ—£ï¸ [MockTTS] window.speechSynthesis overwritten
PAGE LOG: Blocked script execution in 'about:srcdoc' because the document's frame is sandboxed and the 'allow-scripts' permission is not set.
PAGE LOG: %c ğŸ—£ï¸ [MockTTS] Injecting Polyfill (Web Worker) background: #222; color: #bada55
PAGE LOG: ğŸ—£ï¸ [MockTTS] Worker Initialized
PAGE LOG: ğŸ—£ï¸ [MockTTS] window.speechSynthesis overwritten
PAGE LOG: Blocked script execution in 'about:srcdoc' because the document's frame is sandboxed and the 'allow-scripts' permission is not set.
PAGE LOG: [OffloadBookDialog] Rendered. isOpen: false, bookId: undefined, isOffloading: false
PAGE LOG: [BookCover] Rendering Alice's Adventures in Wonderland (6195b2fd-9e01-4d4e-b6c5-7fdd436d1b87). isOffloaded: false
=========================== short test summary info ============================
FAILED verification/test_journey_firestore_sync.py::test_firestore_cross_device_sync[desktop-chromium]
FAILED verification/test_journey_firestore_sync.py::test_firestore_cross_device_sync[mobile-chromium]
FAILED verification/test_journey_visual_reading.py::test_journey_visual_reading[mobile-chromium]
FAILED verification/test_journey_progress_bar.py::test_verify_progress_bar[mobile-chromium]
================== 4 failed, 150 passed in 384.48s (0:06:24) ===================
ğŸš€ Running verification tests with pytest...
Executing: /usr/bin/python -m pytest -n auto verification/
